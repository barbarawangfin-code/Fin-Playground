<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BuffsTheBest Financial Statements Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            margin-bottom: 20px;
            text-align: center;
        }

        h1 {
            color: #764ba2;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 1.2em;
        }

        .game-stats {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 15px;
        }

        .stat-box {
            background: #f0f0f0;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: bold;
        }

        .score {
            color: #4CAF50;
            font-size: 1.5em;
        }

        .streak {
            color: #FF9800;
            font-size: 1.5em;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .transaction-panel {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .transaction-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            color: white;
        }

        .transaction-card.level-1 {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            color: #333;
        }

        .transaction-card.level-2 {
            background: linear-gradient(135deg, #fbc2eb 0%, #a6c1ee 100%);
            color: #333;
        }

        .transaction-card.level-3 {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: #333;
        }

        .transaction-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0,0,0,0.3);
        }

        .transaction-card.selected {
            border: 3px solid #FFD700;
            transform: scale(1.05);
        }

        .transaction-card.processed {
            opacity: 0.6;
            cursor: pointer;
            position: relative;
            border: 2px solid #4CAF50;
        }

        .transaction-card.processed:hover {
            opacity: 0.8;
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(76, 175, 80, 0.3);
        }

        .transaction-card.processed::after {
            content: '‚úì PROCESSED';
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(76, 175, 80, 0.95);
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 0.85em;
        }

        .transaction-card.processed::before {
            content: 'Click to Undo';
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(255, 152, 0, 0.9);
            color: white;
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .transaction-card.processed:hover::before {
            opacity: 1;
        }

        .transaction-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .transaction-amount {
            font-size: 1.4em;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .transaction-desc {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .statements-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .statement {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .statement-header {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
            color: #667eea;
        }

        .statement-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            padding: 8px;
            border-bottom: 1px solid #eee;
            align-items: center;
        }

        .statement-row.header {
            font-weight: bold;
            background: #f5f5f5;
            border-radius: 5px;
        }

        .statement-row.total {
            font-weight: bold;
            background: #e3f2fd;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 1.1em;
        }

        .statement-row.changed {
            background: #fff3cd;
            animation: highlight 1s ease-in-out;
        }

        @keyframes highlight {
            0%, 100% { background: #fff3cd; }
            50% { background: #ffc107; }
        }

        /* Tooltip for showing transaction history */
        .account-value {
            position: relative;
            cursor: help;
        }

        .account-value:hover {
            color: #667eea;
            font-weight: bold;
        }

        .account-tooltip {
            position: absolute;
            bottom: 100%;
            right: 0;
            background: #333;
            color: white;
            padding: 12px;
            border-radius: 8px;
            font-size: 0.85em;
            white-space: nowrap;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
            margin-bottom: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            max-width: 300px;
            white-space: normal;
        }

        .account-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            right: 20px;
            border: 6px solid transparent;
            border-top-color: #333;
        }

        .account-value:hover .account-tooltip {
            opacity: 1;
        }

        .tooltip-title {
            font-weight: bold;
            margin-bottom: 8px;
            color: #FFD700;
            border-bottom: 1px solid #555;
            padding-bottom: 4px;
        }

        .tooltip-transaction {
            padding: 4px 0;
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }

        .tooltip-change-positive {
            color: #4CAF50;
        }

        .tooltip-change-negative {
            color: #f44336;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        button {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-process {
            background: #4CAF50;
            color: white;
        }

        .btn-process:hover:not(:disabled) {
            background: #45a049;
            transform: translateY(-2px);
        }

        .btn-process:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .btn-reset {
            background: #f44336;
            color: white;
        }

        .btn-reset:hover {
            background: #da190b;
        }

        .btn-hint {
            background: #2196F3;
            color: white;
        }

        .btn-hint:hover {
            background: #0b7dda;
        }

        .feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            font-weight: bold;
            text-align: center;
            display: none;
        }

        .feedback.correct {
            background: #d4edda;
            color: #155724;
            display: block;
        }

        .feedback.incorrect {
            background: #f8d7da;
            color: #721c24;
            display: block;
        }

        .hint-box {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid #2196F3;
            display: none;
        }

        .hint-box.show {
            display: block;
        }

        .section-label {
            font-weight: bold;
            margin-top: 10px;
            color: #764ba2;
        }

        .positive {
            color: #4CAF50;
        }

        .negative {
            color: #f44336;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .level-indicator {
            background: #673ab7;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
        }

        .impact-indicator {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            margin-left: 5px;
        }

        .impact-bs {
            background: #e3f2fd;
            color: #1976d2;
        }

        .impact-is {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .impact-cf {
            background: #e8f5e9;
            color: #388e3c;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üç¶ Buff's Frozen Delights üç¶</h1>
            <p class="subtitle">Master the Three Financial Statements!</p>
            
            <div style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); padding: 20px; border-radius: 10px; margin: 15px 0; text-align: left;">
                <h3 style="color: #764ba2; margin-bottom: 10px;">üìñ Your Mission:</h3>
                <p style="color: #333; line-height: 1.6; margin-bottom: 10px;">
                    Welcome to <strong>Buff's Frozen Delights</strong> - the coolest artisan ice cream shop in town! 
                    You're the new accountant, and your job is to record all the shop's transactions and watch how they 
                    flow through the three main financial statements.
                </p>
                <p style="color: #333; line-height: 1.6; margin-bottom: 10px;">
                    üéØ <strong>Your Challenge:</strong> Process each transaction and see the magic happen - one transaction 
                    can affect multiple statements simultaneously! Watch cash flow in and out, inventory transform into sales, 
                    and profits build up in retained earnings.
                </p>
                <p style="color: #555; line-height: 1.6; font-size: 0.95em;">
                    üí° <strong>Pro Tip:</strong> Pay attention to the <span style="background: #FFD700; padding: 2px 6px; border-radius: 3px;">yellow highlights</span> 
                    - they show you exactly what changed! You can also click processed transactions to undo them and try different scenarios.
                </p>
            </div>

            <details style="background: #E3F2FD; padding: 20px; border-radius: 10px; margin: 15px 0; border-left: 5px solid #2196F3;">
                <summary style="cursor: pointer; font-size: 1.2em; font-weight: bold; color: #1565C0; margin-bottom: 10px;">
                    üìö Concept Notes: How the Statements Connect (Click to Expand)
                </summary>
                
                <div style="margin-top: 15px; color: #333;">
                    <div style="background: #FFF3E0; padding: 15px; border-radius: 8px; border-left: 5px solid #FF9800; margin-bottom: 15px;">
                        <h4 style="color: #E65100; margin-bottom: 10px;">üí° The Big Picture</h4>
                        <p style="line-height: 1.6; color: #333;">
                            Think of it this way:<br><br>
                            ‚Ä¢ <strong>Balance Sheet</strong> = Your financial position at a point in time (like a photograph)<br>
                            ‚Ä¢ <strong>Income Statement</strong> = Your profitability over a period (like measuring how tall you grew this year)<br>
                            ‚Ä¢ <strong>Cash Flow Statement</strong> = Your cash movements over a period (like tracking money in and out of your wallet)<br><br>
                            All three work together to tell the complete story of your business. Master the connections, and you'll understand accounting!
                        </p>
                    </div>

                    <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h4 style="color: #667eea; margin-bottom: 10px;">üéØ Key Concepts to Remember</h4>
                        <ul style="line-height: 1.8; color: #555; margin-left: 20px;">
                            <li><strong>Assets = Liabilities + Equity</strong> - Assets show how you USE funds (what you bought), while Liabilities and Equity show the SOURCE of funds (where money came from). This ALWAYS balances (that's why it's called a Balance Sheet!)</li>
                            <li><strong>Revenue - Expenses = Net Income</strong> - Simple formula, but timing matters!</li>
                            <li><strong>Accrual ‚â† Cash</strong> - You can have profit without cash, or cash without profit</li>
                            <li><strong>Depreciation is special</strong> - It's an expense that reduces Net Income but doesn't use cash</li>
                            <li><strong>Buying equipment ‚â† Expense</strong> - It's an asset swap: Cash down, Equipment up (Balance Sheet only)</li>
                            <li><strong>Buying on credit</strong> - Creates Accounts Payable (liability), preserves Cash, no cash outflow until you pay</li>
                            <li><strong>Loan principal ‚â† Expense</strong> - It's a liability reduction (Balance Sheet), not Income Statement</li>
                            <li><strong>Interest IS an expense</strong> - But loan principal payment is not!</li>
                            <li><strong>Credit sales create AR</strong> - Revenue recognized immediately, but cash collected later</li>
                            <li><strong>Working capital matters</strong> - Changes in AR, Inventory, and AP all affect cash flow</li>
                        </ul>
                    </div>

                    <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h4 style="color: #667eea; margin-bottom: 10px;">üîó How Everything Connects</h4>
                        <p style="line-height: 1.6; margin-bottom: 15px;">
                            The three financial statements are like three cameras filming the same movie from different angles. 
                            They all tell the story of your business, but each focuses on something different.
                        </p>
                    </div>

                    <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h4 style="color: #667eea; margin-bottom: 10px;">üìä Income Statement ‚ÜîÔ∏è Balance Sheet</h4>
                        <p style="line-height: 1.6; margin-bottom: 8px;">
                            <strong>The Link:</strong> Net Income from the Income Statement flows directly into Retained Earnings on the Balance Sheet.
                        </p>
                        <p style="line-height: 1.6; margin-bottom: 8px; font-style: italic; color: #555;">
                            Example: If you earned $5,000 Net Income, Retained Earnings increases by $5,000. If you lost $2,000, Retained Earnings decreases by $2,000.
                        </p>
                        <p style="line-height: 1.6; color: #555;">
                            <strong>Why?</strong> Profits belong to the owners - they increase ownership (Equity). Losses decrease it. Retained Earnings is where we accumulate these profits/losses.
                        </p>
                    </div>

                    <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h4 style="color: #667eea; margin-bottom: 10px;">üí∞ Income Statement ‚ÜîÔ∏è Cash Flow Statement</h4>
                        <p style="line-height: 1.6; margin-bottom: 8px;">
                            <strong>The Link:</strong> Net Income is the STARTING POINT for Operating Cash Flow (Indirect Method).
                        </p>
                        <p style="line-height: 1.6; margin-bottom: 8px; font-style: italic; color: #555;">
                            Example: Net Income = $5,000, but Cash from Operations might be $3,000 or $7,000. Why? Because of non-cash expenses like depreciation!
                        </p>
                        <p style="line-height: 1.6; color: #555;">
                            <strong>Key Adjustment:</strong><br>
                            ‚Ä¢ <strong>Add back Depreciation:</strong> It's an expense that reduces Net Income, but no cash actually left the company. The cash was spent when we bought the equipment. Depreciation just spreads that cost over time.
                        </p>
                    </div>

                    <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h4 style="color: #667eea; margin-bottom: 10px;">üíµ Balance Sheet ‚ÜîÔ∏è Cash Flow Statement</h4>
                        <p style="line-height: 1.6; margin-bottom: 8px;">
                            <strong>The Link:</strong> The change in Cash on the Balance Sheet MUST equal the Net Change in Cash on the Cash Flow Statement.
                        </p>
                        <p style="line-height: 1.6; margin-bottom: 8px; font-style: italic; color: #555;">
                            Example: If Cash started at $10,000 and ended at $13,000, the Cash Flow Statement must show a Net Change of +$3,000.
                        </p>
                        <p style="line-height: 1.6; margin-bottom: 12px; color: #555;">
                            <strong>Why?</strong> The Balance Sheet shows WHERE you are (snapshot), and the Cash Flow Statement shows HOW you got there (the journey).
                        </p>
                        <p style="line-height: 1.6; margin-bottom: 8px; color: #333;">
                            <strong>Changes in Balance Sheet accounts affect Cash Flow in three sections:</strong>
                        </p>
                        <p style="line-height: 1.6; margin-bottom: 8px; color: #333;">
                            <strong>Operating Activities - Working Capital Changes:</strong>
                        </p>
                        <p style="line-height: 1.6; color: #555; margin-left: 15px; margin-bottom: 12px;">
                            ‚Ä¢ <strong>AR increases:</strong> Made sales but didn't collect cash yet (subtract from Operations)<br>
                            ‚Ä¢ <strong>AR decreases:</strong> Collected cash from past sales (add to Operations)<br>
                            ‚Ä¢ <strong>Inventory increases:</strong> Bought inventory, used cash (subtract from Operations)<br>
                            ‚Ä¢ <strong>Inventory decreases:</strong> Sold inventory, generated cash (add to Operations)<br>
                            ‚Ä¢ <strong>AP increases:</strong> Bought on credit, preserved cash (add to Operations)<br>
                            ‚Ä¢ <strong>AP decreases:</strong> Paid suppliers, used cash (subtract from Operations)
                        </p>
                        <p style="line-height: 1.6; margin-bottom: 8px; color: #333;">
                            <strong>Investing Activities - Fixed Asset Changes:</strong>
                        </p>
                        <p style="line-height: 1.6; color: #555; margin-left: 15px; margin-bottom: 12px;">
                            ‚Ä¢ <strong>Equipment increases:</strong> Bought equipment, used cash (negative on CF)<br>
                            ‚Ä¢ <strong>Equipment decreases:</strong> Sold equipment, received cash (positive on CF)<br>
                            ‚Ä¢ Note: Depreciation reduces equipment but doesn't affect cash (already adjusted in Operations)
                        </p>
                        <p style="line-height: 1.6; margin-bottom: 8px; color: #333;">
                            <strong>Financing Activities - Debt & Equity Changes:</strong>
                        </p>
                        <p style="line-height: 1.6; color: #555; margin-left: 15px;">
                            ‚Ä¢ <strong>Loan increases:</strong> Borrowed money, received cash (positive on CF)<br>
                            ‚Ä¢ <strong>Loan decreases:</strong> Paid off debt, used cash (negative on CF)<br>
                            ‚Ä¢ <strong>Equity increases:</strong> Owner invested, received cash (positive on CF)<br>
                            ‚Ä¢ <strong>Equity decreases:</strong> Paid dividends, used cash (negative on CF)
                        </p>
                    </div>
                </div>
            </details>
            
            <div class="game-stats">
                <div class="stat-box">
                    <span>Score: </span><span class="score" id="score">0</span>
                </div>
                <div class="stat-box">
                    <span>Streak: </span><span class="streak" id="streak">0</span> üî•
                </div>
                <div class="stat-box">
                    <span class="level-indicator" id="level">Level 1: Beginner</span>
                </div>
            </div>
        </header>

        <div class="main-content">
            <div class="transaction-panel">
                <h2 style="margin-bottom: 15px; color: #764ba2;">üìã Monthly Transactions</h2>
                <p style="margin-bottom: 15px; color: #666;">Select a transaction and process it. Watch how it affects all three statements!</p>
                
                <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
                    <div style="display: flex; align-items: center; gap: 5px;">
                        <div style="width: 20px; height: 20px; background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); border-radius: 4px;"></div>
                        <span style="font-size: 0.9em; color: #666;">Level 1</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 5px;">
                        <div style="width: 20px; height: 20px; background: linear-gradient(135deg, #fbc2eb 0%, #a6c1ee 100%); border-radius: 4px;"></div>
                        <span style="font-size: 0.9em; color: #666;">Level 2</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 5px;">
                        <div style="width: 20px; height: 20px; background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); border-radius: 4px;"></div>
                        <span style="font-size: 0.9em; color: #666;">Level 3</span>
                    </div>
                </div>
                
                <div id="transactions"></div>
                <div class="controls">
                    <button class="btn-process" id="processBtn" disabled>Process Transaction</button>
                </div>
                <div class="controls">
                    <button class="btn-hint" id="hintBtn">üí° Show Hint</button>
                    <button class="btn-reset" id="resetBtn">üîÑ Reset Game</button>
                </div>
                <div id="feedback" class="feedback"></div>
                <div id="hint" class="hint-box"></div>
            </div>

            <div class="statements-container">
                <!-- Balance Sheet -->
                <div class="statement">
                    <div class="statement-header">üìä Balance Sheet (as of current date)</div>
                    <div class="statement-row header">
                        <span>Account</span>
                        <span style="text-align: center;">Beginning</span>
                        <span style="text-align: right;">Current</span>
                    </div>
                    <div class="section-label">Assets</div>
                    <div class="statement-row">
                        <span>Cash</span>
                        <span style="text-align: center; color: #999;" id="beginCash">$10,000</span>
                        <span style="text-align: right;" id="cash">$10,000</span>
                    </div>
                    <div class="statement-row">
                        <span>Accounts Receivable</span>
                        <span style="text-align: center; color: #999;" id="beginAR">$500</span>
                        <span style="text-align: right;" id="ar">$500</span>
                    </div>
                    <div class="statement-row">
                        <span>Inventory</span>
                        <span style="text-align: center; color: #999;" id="beginInventory">$2,000</span>
                        <span style="text-align: right;" id="inventory">$2,000</span>
                    </div>
                    <div class="statement-row">
                        <span>Equipment (Gross)</span>
                        <span style="text-align: center; color: #999;" id="beginEquipmentGross">$15,000</span>
                        <span style="text-align: right;" id="equipmentGross">$15,000</span>
                    </div>
                    <div class="statement-row">
                        <span style="margin-left: 20px;">Less: Accumulated Depreciation</span>
                        <span style="text-align: center; color: #999;" id="beginAccumulatedDepreciation">$0</span>
                        <span style="text-align: right;" id="accumulatedDepreciation">$0</span>
                    </div>
                    <div class="statement-row">
                        <span style="margin-left: 20px;">Equipment (Net)</span>
                        <span style="text-align: center; color: #999;" id="beginEquipment">$15,000</span>
                        <span style="text-align: right;" id="equipment">$15,000</span>
                    </div>
                    <div class="statement-row total">
                        <span>Total Assets</span>
                        <span style="text-align: center; color: #999;" id="beginTotalAssets">$27,500</span>
                        <span style="text-align: right;" id="totalAssets">$27,500</span>
                    </div>

                    <div class="section-label">Liabilities</div>
                    <div class="statement-row">
                        <span>Accounts Payable</span>
                        <span style="text-align: center; color: #999;" id="beginAP">$500</span>
                        <span style="text-align: right;" id="ap">$500</span>
                    </div>
                    <div class="statement-row">
                        <span>Loan Payable</span>
                        <span style="text-align: center; color: #999;" id="beginLoan">$10,000</span>
                        <span style="text-align: right;" id="loan">$10,000</span>
                    </div>
                    <div class="statement-row total">
                        <span>Total Liabilities</span>
                        <span style="text-align: center; color: #999;" id="beginTotalLiabilities">$10,500</span>
                        <span style="text-align: right;" id="totalLiabilities">$10,500</span>
                    </div>

                    <div class="section-label">Equity</div>
                    <div class="statement-row">
                        <span>Owner's Equity</span>
                        <span style="text-align: center; color: #999;" id="beginEquityOwner">$16,500</span>
                        <span style="text-align: right;" id="equity">$16,500</span>
                    </div>
                    <div class="statement-row">
                        <span>Retained Earnings</span>
                        <span style="text-align: center; color: #999;" id="beginRetainedEarnings">$0</span>
                        <span style="text-align: right;" id="retainedEarnings">$0</span>
                    </div>
                    <div class="statement-row total">
                        <span>Total Equity</span>
                        <span style="text-align: center; color: #999;" id="beginTotalEquity">$16,500</span>
                        <span style="text-align: right;" id="totalEquity">$16,500</span>
                    </div>
                </div>

                <!-- Income Statement -->
                <div class="statement">
                    <div class="statement-header">üí∞ Income Statement (current period)</div>
                    <div class="section-label">Revenue</div>
                    <div class="statement-row">
                        <span>Ice Cream Sales</span>
                        <span id="sales">$0</span>
                    </div>
                    
                    <div class="section-label">Expenses</div>
                    <div class="statement-row">
                        <span>Cost of Goods Sold</span>
                        <span id="cogs">$0</span>
                    </div>
                    <div class="statement-row">
                        <span>Rent Expense</span>
                        <span id="rent">$0</span>
                    </div>
                    <div class="statement-row">
                        <span>Utilities Expense</span>
                        <span id="utilities">$0</span>
                    </div>
                    <div class="statement-row">
                        <span>Wages Expense</span>
                        <span id="wages">$0</span>
                    </div>
                    <div class="statement-row">
                        <span>Depreciation Expense</span>
                        <span id="depreciation">$0</span>
                    </div>
                    <div class="statement-row">
                        <span>Interest Expense</span>
                        <span id="interest">$0</span>
                    </div>
                    <div class="statement-row total">
                        <span>Net Income</span>
                        <span id="netIncome">$0</span>
                    </div>
                </div>

                <!-- Cash Flow Statement -->
                <div class="statement">
                    <div class="statement-header">üíµ Cash Flow Statement (current period)</div>
                    <div class="section-label">Operating Activities (Indirect Method)</div>
                    <div class="statement-row">
                        <span>Net Income</span>
                        <span id="cfNetIncome">$0</span>
                    </div>
                    <div class="statement-row">
                        <span>Add: Depreciation Expense</span>
                        <span id="cfDepreciation">$0</span>
                    </div>
                    <div class="statement-row">
                        <span>Increase in Accounts Receivable</span>
                        <span id="cfARChange">$0</span>
                    </div>
                    <div class="statement-row">
                        <span>Decrease in Inventory</span>
                        <span id="cfInventoryChange">$0</span>
                    </div>
                    <div class="statement-row">
                        <span>Increase in Accounts Payable</span>
                        <span id="cfAPChange">$0</span>
                    </div>
                    <div class="statement-row total">
                        <span>Net Cash from Operations</span>
                        <span id="cfOperations">$0</span>
                    </div>

                    <div class="section-label">Investing Activities</div>
                    <div class="statement-row">
                        <span>Equipment Purchases</span>
                        <span id="cfInvesting">$0</span>
                    </div>

                    <div class="section-label">Financing Activities</div>
                    <div class="statement-row">
                        <span>Loan Proceeds/Payments</span>
                        <span id="cfFinancing">$0</span>
                    </div>

                    <div class="statement-row total">
                        <span>Net Change in Cash</span>
                        <span id="netCashChange">$0</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game State
        let gameState = {
            cash: 10000,
            ar: 500,  // Changed from 0 to 500 so there's a change to show on CF
            inventory: 2000,
            equipmentGross: 15000,  // Gross fixed assets
            accumulatedDepreciation: 0,  // Accumulated depreciation
            equipment: 15000,  // Net fixed assets (Gross - Accumulated)
            ap: 500,  // Changed from 0 to 500 so there's a change to show on CF
            loan: 10000,
            equity: 16500,  // Adjusted to balance (Assets 27500 - Liabilities 10500)
            retainedEarnings: 0,
            sales: 0,
            cogs: 0,
            rent: 0,
            utilities: 0,
            wages: 0,
            depreciation: 0,
            interest: 0,
            // Beginning balances for Balance Sheet (to show changes)
            beginCash: 10000,
            beginningAR: 500,  // Changed to 500
            beginningInventory: 2000,
            beginEquipmentGross: 15000,
            beginAccumulatedDepreciation: 0,
            beginEquipment: 15000,
            beginningAP: 500,  // Changed to 500
            beginLoan: 10000,
            beginEquityOwner: 16500,  // Updated to match current equity
            beginRetainedEarnings: 0,
            cfCustomers: 0,
            cfSuppliers: 0,
            cfExpenses: 0,
            cfInvesting: 0,
            cfFinancing: 0,
            score: 0,
            streak: 0,
            level: 1,
            processedTransactions: [], // Track which transactions have been processed
            transactionHistory: {} // Track which transactions affected which accounts
        };

        let selectedTransaction = null;
        let changedElements = [];

        // Transaction definitions
        const transactions = [
            {
                id: 1,
                title: "Ice Cream Sales (Cash)",
                amount: 5000,
                description: "Sold ice cream to walk-in customers for cash",
                level: 1,
                impacts: ['BS', 'IS', 'CF'],
                process: (state) => {
                    const cogs = 2000; // 40% cost
                    return {
                        cash: state.cash + 5000,
                        inventory: state.inventory - cogs,
                        sales: state.sales + 5000,
                        cogs: state.cogs + cogs
                    };
                },
                hint: "Cash sales increase Cash (BS), Sales Revenue (IS), and inventory decreases by COGS. On the Cash Flow Statement (indirect method): sales increase Net Income, and inventory decrease is a source of cash!"
            },
            {
                id: 2,
                title: "Purchase Inventory (Cash)",
                amount: 1500,
                description: "Bought ice cream ingredients with cash",
                level: 1,
                impacts: ['BS', 'CF'],
                process: (state) => {
                    return {
                        cash: state.cash - 1500,
                        inventory: state.inventory + 1500
                    };
                },
                hint: "Buying inventory with cash: Cash goes down, Inventory goes up (both assets). On indirect method CF: inventory increase uses cash!"
            },
            {
                id: 3,
                title: "Pay Rent",
                amount: 2000,
                description: "Paid monthly rent for the shop",
                level: 1,
                impacts: ['BS', 'IS', 'CF'],
                process: (state) => {
                    return {
                        cash: state.cash - 2000,
                        rent: state.rent + 2000
                    };
                },
                hint: "Rent payment: Cash decreases (BS), Rent Expense increases (IS). On Cash Flow: expense reduces Net Income, and cash went out, so both effects show the cash decrease."
            },
            {
                id: 4,
                title: "Ice Cream Sales (Credit)",
                amount: 2500,
                description: "Sold ice cream to a catering company on account",
                level: 2,
                impacts: ['BS', 'IS'],
                process: (state) => {
                    const cogs = 1000;
                    return {
                        ar: state.ar + 2500,
                        inventory: state.inventory - cogs,
                        sales: state.sales + 2500,
                        cogs: state.cogs + cogs
                    };
                },
                hint: "Credit sales: No cash yet! Accounts Receivable increases (BS), Sales and COGS hit Income Statement. On CF (indirect): sales increase Net Income, but AR increase means cash not collected yet (subtracts from operations)."
            },
            {
                id: 5,
                title: "Collect Receivables",
                amount: 2500,
                description: "Received payment from catering company",
                level: 2,
                impacts: ['BS', 'CF'],
                process: (state) => {
                    return {
                        cash: state.cash + 2500,
                        ar: state.ar - 2500
                    };
                },
                hint: "Collecting receivables: Cash up, AR down (both assets on BS). On CF (indirect): AR decrease adds to cash from operations. No Income Statement impact - revenue was already recorded!"
            },
            {
                id: 6,
                title: "Purchase Equipment",
                amount: 5000,
                description: "Bought a new ice cream maker with cash",
                level: 2,
                impacts: ['BS', 'CF'],
                process: (state) => {
                    return {
                        cash: state.cash - 5000,
                        equipmentGross: state.equipmentGross + 5000,
                        equipment: state.equipment + 5000,
                        cfInvesting: state.cfInvesting - 5000
                    };
                },
                hint: "Equipment purchase: Cash decreases, Equipment (Gross and Net) increases (both BS). Shows in Investing Activities on Cash Flow. This is an asset, not an expense!"
            },
            {
                id: 13,
                title: "Buy Equipment with Bank Loan",
                amount: 8000,
                description: "Bought new freezer equipment, financed with bank loan",
                level: 2,
                impacts: ['BS', 'CF'],
                process: (state) => {
                    return {
                        equipmentGross: state.equipmentGross + 8000,
                        equipment: state.equipment + 8000,
                        loan: state.loan + 8000,
                        cfInvesting: state.cfInvesting - 8000,
                        cfFinancing: state.cfFinancing + 8000
                    };
                },
                hint: "This transaction has TWO cash flow effects! Investing: -$8K for equipment purchase. Financing: +$8K from bank loan. Net cash flow = $0, but both activities must be shown separately. Equipment (Gross and Net) increases, Loan Payable increases."
            },
            {
                id: 7,
                title: "Pay Wages",
                amount: 1800,
                description: "Paid employee wages for the month",
                level: 1,
                impacts: ['BS', 'IS', 'CF'],
                process: (state) => {
                    return {
                        cash: state.cash - 1800,
                        wages: state.wages + 1800,
                        cfExpenses: state.cfExpenses - 1800
                    };
                },
                hint: "Wage payment: Cash decreases (BS), Wages Expense increases (IS), operating cash outflow (CF)."
            },
            {
                id: 8,
                title: "Purchase Inventory (Credit)",
                amount: 1200,
                description: "Bought ingredients on account from supplier",
                level: 2,
                impacts: ['BS'],
                process: (state) => {
                    return {
                        inventory: state.inventory + 1200,
                        ap: state.ap + 1200
                    };
                },
                hint: "Buying on credit: Inventory (asset) increases, Accounts Payable (liability) increases. Balance Sheet only! No cash or income impact yet."
            },
            {
                id: 9,
                title: "Pay Accounts Payable",
                amount: 1200,
                description: "Paid supplier for previous credit purchase",
                level: 2,
                impacts: ['BS', 'CF'],
                process: (state) => {
                    return {
                        cash: state.cash - 1200,
                        ap: state.ap - 1200,
                        cfSuppliers: state.cfSuppliers - 1200
                    };
                },
                hint: "Paying AP: Cash decreases (asset), AP decreases (liability). Operating cash outflow. No expense - that was recorded at purchase!"
            },
            {
                id: 10,
                title: "Pay Loan Principal",
                amount: 1000,
                description: "Made principal payment on loan",
                level: 3,
                impacts: ['BS', 'CF'],
                process: (state) => {
                    return {
                        cash: state.cash - 1000,
                        loan: state.loan - 1000,
                        cfFinancing: state.cfFinancing - 1000
                    };
                },
                hint: "Loan principal payment: Cash decreases (asset), Loan Payable decreases (liability). Financing activity on CF. This is NOT an expense!"
            },
            {
                id: 11,
                title: "Pay Loan Interest",
                amount: 100,
                description: "Paid interest on loan",
                level: 3,
                impacts: ['BS', 'IS', 'CF'],
                process: (state) => {
                    return {
                        cash: state.cash - 100,
                        interest: state.interest + 100,
                        cfExpenses: state.cfExpenses - 100
                    };
                },
                hint: "Interest payment: Cash decreases (BS), Interest Expense increases (IS), operating cash outflow (CF). Interest is an expense, unlike principal!"
            },
            {
                id: 14,
                title: "Record Depreciation Expense",
                amount: 500,
                description: "Monthly depreciation on equipment (non-cash expense)",
                level: 3,
                impacts: ['BS', 'IS'],
                process: (state) => {
                    return {
                        accumulatedDepreciation: state.accumulatedDepreciation + 500,
                        equipment: state.equipment - 500,  // Net equipment decreases
                        depreciation: state.depreciation + 500
                    };
                },
                hint: "Depreciation is a NON-CASH expense! Accumulated Depreciation increases (contra-asset), reducing Net Equipment on the Balance Sheet. Depreciation Expense increases (IS), reducing Net Income. No CF impact because no cash was paid. The cash was already spent when we bought the equipment!"
            },
            {
                id: 12,
                title: "Pay Utilities",
                amount: 300,
                description: "Paid electricity and water bills",
                level: 1,
                impacts: ['BS', 'IS', 'CF'],
                process: (state) => {
                    return {
                        cash: state.cash - 300,
                        utilities: state.utilities + 300,
                        cfExpenses: state.cfExpenses - 300
                    };
                },
                hint: "Utilities payment: Cash decreases (BS), Utilities Expense increases (IS), operating cash outflow (CF)."
            }
        ];

        // Initialize game
        function init() {
            renderTransactions();
            updateDisplay();
        }

        function renderTransactions() {
            const container = document.getElementById('transactions');
            const currentLevel = gameState.level;
            const availableTransactions = transactions.filter(t => t.level <= currentLevel);
            
            container.innerHTML = availableTransactions.map(t => {
                const isProcessed = gameState.processedTransactions.includes(t.id);
                return `
                <div class="transaction-card level-${t.level} ${isProcessed ? 'processed' : ''}" data-id="${t.id}">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <span style="background: rgba(255,255,255,0.9); padding: 4px 10px; border-radius: 12px; font-size: 0.85em; font-weight: bold; color: #764ba2;">
                            Level ${t.level}
                        </span>
                    </div>
                    <div class="transaction-title">
                        ${t.title}
                        ${t.impacts.map(i => `<span class="impact-indicator impact-${i.toLowerCase()}">${i}</span>`).join('')}
                    </div>
                    <div class="transaction-amount">$${t.amount.toLocaleString()}</div>
                    <div class="transaction-desc">${t.description}</div>
                </div>
            `}).join('');

            // Add click handlers
            document.querySelectorAll('.transaction-card').forEach(card => {
                const id = parseInt(card.dataset.id);
                const isProcessed = gameState.processedTransactions.includes(id);
                if (!isProcessed) {
                    card.addEventListener('click', () => selectTransaction(id));
                } else {
                    card.addEventListener('click', () => unprocessTransaction(id));
                }
            });
        }

        function selectTransaction(id) {
            selectedTransaction = transactions.find(t => t.id === id);
            
            // Update UI
            document.querySelectorAll('.transaction-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.target.closest('.transaction-card').classList.add('selected');
            
            document.getElementById('processBtn').disabled = false;
            document.getElementById('hint').classList.remove('show');
            document.getElementById('feedback').style.display = 'none';
        }

        function processTransaction() {
            if (!selectedTransaction) return;

            // Mark this transaction as processed
            gameState.processedTransactions.push(selectedTransaction.id);

            // Clear previous highlights
            changedElements.forEach(el => el.classList.remove('changed'));
            changedElements = [];

            // Store old state for comparison
            const oldState = {...gameState};

            // Process transaction
            const updates = selectedTransaction.process(gameState);
            Object.assign(gameState, updates);
            
            // Track which accounts this transaction affected
            Object.keys(updates).forEach(account => {
                if (oldState[account] !== gameState[account]) {
                    if (!gameState.transactionHistory[account]) {
                        gameState.transactionHistory[account] = [];
                    }
                    gameState.transactionHistory[account].push({
                        id: selectedTransaction.id,
                        title: selectedTransaction.title,
                        change: gameState[account] - oldState[account]
                    });
                }
            });

            // Calculate derived values
            updateDerivedValues();

            // Update display
            updateDisplay();

            // Highlight changed elements
            highlightChanges(oldState, gameState);

            // Update score
            gameState.score += 100 * gameState.level;
            gameState.streak++;
            updateScore();

            // Check for level up
            checkLevelUp();

            // Show feedback
            showFeedback(true, `Great job! Transaction processed correctly. +${100 * gameState.level} points!`);

            // Reset selection
            selectedTransaction = null;
            document.querySelectorAll('.transaction-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.getElementById('processBtn').disabled = true;
            
            // Re-render transactions to show processed state
            renderTransactions();
        }

        function unprocessTransaction(id) {
            if (!confirm('Undo this transaction? This will reverse its effects on the financial statements.')) {
                return;
            }

            const transaction = transactions.find(t => t.id === id);
            if (!transaction) return;

            // Remove from processed list
            gameState.processedTransactions = gameState.processedTransactions.filter(tid => tid !== id);
            
            // Remove from transaction history
            Object.keys(gameState.transactionHistory).forEach(account => {
                gameState.transactionHistory[account] = gameState.transactionHistory[account].filter(
                    tx => tx.id !== id
                );
            });

            // Clear previous highlights
            changedElements.forEach(el => el.classList.remove('changed'));
            changedElements = [];

            // Store old state for comparison
            const oldState = {...gameState};

            // Reverse the transaction by applying negative effects
            const updates = transaction.process(gameState);
            Object.keys(updates).forEach(key => {
                // Reverse the update: subtract what was added, add what was subtracted
                const change = updates[key] - oldState[key];
                gameState[key] = oldState[key] - change;
            });

            // Calculate derived values
            updateDerivedValues();

            // Update display
            updateDisplay();

            // Highlight changed elements
            highlightChanges(oldState, gameState);

            // Reduce score (but don't go negative)
            gameState.score = Math.max(0, gameState.score - (100 * gameState.level));
            updateScore();

            // Show feedback
            showFeedback(true, `Transaction reversed! Effects have been undone from the financial statements.`);

            // Re-render transactions
            renderTransactions();
        }

        function updateDerivedValues() {
            // Calculate totals
            gameState.totalAssets = gameState.cash + gameState.ar + gameState.inventory + gameState.equipment;
            gameState.totalLiabilities = gameState.ap + gameState.loan;
            
            // Calculate net income
            const totalRevenue = gameState.sales;
            const totalExpenses = gameState.cogs + gameState.rent + gameState.utilities + gameState.wages + gameState.depreciation + gameState.interest;
            gameState.netIncome = totalRevenue - totalExpenses;
            
            // Update retained earnings with net income
            gameState.retainedEarnings = gameState.netIncome;
            
            // Calculate total equity
            gameState.totalEquity = gameState.equity + gameState.retainedEarnings;
            
            // Calculate working capital changes (Indirect Method)
            gameState.arChange = gameState.ar - gameState.beginningAR;
            gameState.inventoryChange = gameState.beginningInventory - gameState.inventory; // Decrease is positive
            gameState.apChange = gameState.ap - gameState.beginningAP;
            
            // Calculate cash flow from operations (Indirect Method)
            gameState.cfOperations = gameState.netIncome 
                + gameState.depreciation 
                - gameState.arChange 
                + gameState.inventoryChange 
                + gameState.apChange;
            
            // Calculate net cash change
            gameState.netCashChange = gameState.cfOperations + gameState.cfInvesting + gameState.cfFinancing;
        }

        function updateDisplay() {
            // Balance Sheet - Beginning Balances
            document.getElementById('beginCash').textContent = formatCurrency(gameState.beginCash);
            document.getElementById('beginAR').textContent = formatCurrency(gameState.beginningAR);
            document.getElementById('beginInventory').textContent = formatCurrency(gameState.beginningInventory);
            document.getElementById('beginEquipmentGross').textContent = formatCurrency(gameState.beginEquipmentGross);
            document.getElementById('beginAccumulatedDepreciation').textContent = formatCurrency(gameState.beginAccumulatedDepreciation);
            document.getElementById('beginEquipment').textContent = formatCurrency(gameState.beginEquipment);
            const beginTotalAssets = gameState.beginCash + gameState.beginningAR + gameState.beginningInventory + gameState.beginEquipment;
            document.getElementById('beginTotalAssets').textContent = formatCurrency(beginTotalAssets);
            
            document.getElementById('beginAP').textContent = formatCurrency(gameState.beginningAP);
            document.getElementById('beginLoan').textContent = formatCurrency(gameState.beginLoan);
            const beginTotalLiabilities = gameState.beginningAP + gameState.beginLoan;
            document.getElementById('beginTotalLiabilities').textContent = formatCurrency(beginTotalLiabilities);
            
            document.getElementById('beginEquityOwner').textContent = formatCurrency(gameState.beginEquityOwner);
            document.getElementById('beginRetainedEarnings').textContent = formatCurrency(gameState.beginRetainedEarnings);
            const beginTotalEquity = gameState.beginEquityOwner + gameState.beginRetainedEarnings;
            document.getElementById('beginTotalEquity').textContent = formatCurrency(beginTotalEquity);
            
            // Balance Sheet - Current Balances (with tooltips)
            document.getElementById('cash').innerHTML = formatCurrencyWithTooltip(gameState.cash, 'cash');
            document.getElementById('ar').innerHTML = formatCurrencyWithTooltip(gameState.ar, 'ar');
            document.getElementById('inventory').innerHTML = formatCurrencyWithTooltip(gameState.inventory, 'inventory');
            document.getElementById('equipmentGross').innerHTML = formatCurrencyWithTooltip(gameState.equipmentGross, 'equipmentGross');
            document.getElementById('accumulatedDepreciation').innerHTML = formatCurrencyWithTooltip(gameState.accumulatedDepreciation, 'accumulatedDepreciation');
            document.getElementById('equipment').innerHTML = formatCurrencyWithTooltip(gameState.equipment, 'equipment');
            document.getElementById('totalAssets').textContent = formatCurrency(gameState.totalAssets);
            
            document.getElementById('ap').innerHTML = formatCurrencyWithTooltip(gameState.ap, 'ap');
            document.getElementById('loan').innerHTML = formatCurrencyWithTooltip(gameState.loan, 'loan');
            document.getElementById('totalLiabilities').textContent = formatCurrency(gameState.totalLiabilities);
            
            document.getElementById('equity').innerHTML = formatCurrencyWithTooltip(gameState.equity, 'equity');
            document.getElementById('retainedEarnings').innerHTML = formatCurrencyWithTooltip(gameState.retainedEarnings, 'retainedEarnings');
            document.getElementById('totalEquity').textContent = formatCurrency(gameState.totalEquity);
            
            // Income Statement (with tooltips)
            document.getElementById('sales').innerHTML = formatCurrencyWithTooltip(gameState.sales, 'sales');
            document.getElementById('cogs').innerHTML = formatCurrencyWithTooltip(gameState.cogs, 'cogs');
            document.getElementById('rent').innerHTML = formatCurrencyWithTooltip(gameState.rent, 'rent');
            document.getElementById('utilities').innerHTML = formatCurrencyWithTooltip(gameState.utilities, 'utilities');
            document.getElementById('wages').innerHTML = formatCurrencyWithTooltip(gameState.wages, 'wages');
            document.getElementById('depreciation').innerHTML = formatCurrencyWithTooltip(gameState.depreciation, 'depreciation');
            document.getElementById('interest').innerHTML = formatCurrencyWithTooltip(gameState.interest, 'interest');
            document.getElementById('netIncome').textContent = formatCurrency(gameState.netIncome, true);
            
            // Cash Flow
            document.getElementById('cfNetIncome').textContent = formatCurrency(gameState.netIncome, true);
            document.getElementById('cfDepreciation').textContent = formatCurrency(gameState.depreciation);
            document.getElementById('cfARChange').textContent = formatCurrency(-gameState.arChange, true);
            document.getElementById('cfInventoryChange').textContent = formatCurrency(gameState.inventoryChange, true);
            document.getElementById('cfAPChange').textContent = formatCurrency(gameState.apChange, true);
            document.getElementById('cfOperations').textContent = formatCurrency(gameState.cfOperations, true);
            document.getElementById('cfInvesting').textContent = formatCurrency(gameState.cfInvesting, true);
            document.getElementById('cfFinancing').textContent = formatCurrency(gameState.cfFinancing, true);
            document.getElementById('netCashChange').textContent = formatCurrency(gameState.netCashChange, true);
        }

        function highlightChanges(oldState, newState) {
            const mappings = {
                cash: 'cash', ar: 'ar', inventory: 'inventory',
                equipmentGross: 'equipmentGross', accumulatedDepreciation: 'accumulatedDepreciation', equipment: 'equipment',
                ap: 'ap', loan: 'loan', retainedEarnings: 'retainedEarnings',
                sales: 'sales', cogs: 'cogs', rent: 'rent', utilities: 'utilities',
                wages: 'wages', depreciation: 'depreciation', interest: 'interest', netIncome: 'netIncome',
                cfOperations: 'cfOperations',
                cfInvesting: 'cfInvesting', cfFinancing: 'cfFinancing',
                netCashChange: 'netCashChange'
            };

            Object.keys(mappings).forEach(key => {
                if (oldState[key] !== newState[key]) {
                    const element = document.getElementById(mappings[key]);
                    if (element) {
                        element.closest('.statement-row').classList.add('changed');
                        changedElements.push(element.closest('.statement-row'));
                    }
                }
            });
        }

        function formatCurrency(value, showSign = false) {
            const formatted = Math.abs(value).toLocaleString('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 0
            });
            
            if (value < 0) {
                if (showSign) {
                    return `(${formatted})`;
                } else {
                    return '-' + formatted;
                }
            }
            return formatted;
        }

        function formatCurrencyWithTooltip(value, accountName) {
            const formattedValue = formatCurrency(value);
            const history = gameState.transactionHistory[accountName];
            
            if (!history || history.length === 0) {
                return `<span class="account-value">${formattedValue}</span>`;
            }
            
            let tooltipContent = '<div class="tooltip-title">Transactions:</div>';
            history.forEach(tx => {
                const changeClass = tx.change > 0 ? 'tooltip-change-positive' : 'tooltip-change-negative';
                const changeSign = tx.change > 0 ? '+' : '';
                tooltipContent += `
                    <div class="tooltip-transaction">
                        <span>${tx.title}</span>
                        <span class="${changeClass}">${changeSign}${formatCurrency(tx.change)}</span>
                    </div>
                `;
            });
            
            return `
                <span class="account-value">
                    ${formattedValue}
                    <div class="account-tooltip">
                        ${tooltipContent}
                    </div>
                </span>
            `;
        }

        function updateScore() {
            document.getElementById('score').textContent = gameState.score.toLocaleString();
            document.getElementById('streak').textContent = gameState.streak;
            updateLevelProgress();
        }

        function checkLevelUp() {
            const oldLevel = gameState.level;
            if (gameState.score >= 1000 && gameState.level < 3) {
                gameState.level = 3;
            } else if (gameState.score >= 500 && gameState.level < 2) {
                gameState.level = 2;
            }

            if (oldLevel !== gameState.level) {
                const levelNames = ['', 'Beginner', 'Intermediate', 'Advanced'];
                document.getElementById('level').textContent = `Level ${gameState.level}: ${levelNames[gameState.level]}`;
                renderTransactions();
                showFeedback(true, `üéâ Level Up! You've reached ${levelNames[gameState.level]} level! More transactions unlocked!`);
            }
            
            // Update level progress display
            updateLevelProgress();
        }

        function updateLevelProgress() {
            const score = gameState.score;
            const level = gameState.level;
            let nextLevelScore, progressText;
            
            if (level === 1) {
                nextLevelScore = 500;
                progressText = `${score}/500 points to Level 2`;
            } else if (level === 2) {
                nextLevelScore = 1000;
                progressText = `${score}/1000 points to Level 3`;
            } else {
                progressText = `Max Level Reached!`;
            }
            
            document.getElementById('level').textContent = `Level ${level}: ${progressText}`;
        }

        function showFeedback(isCorrect, message) {
            const feedback = document.getElementById('feedback');
            feedback.className = 'feedback ' + (isCorrect ? 'correct' : 'incorrect');
            feedback.textContent = message;
            feedback.style.display = 'block';
        }

        function showHint() {
            const hint = document.getElementById('hint');
            if (selectedTransaction) {
                hint.textContent = selectedTransaction.hint;
                hint.classList.add('show');
            } else {
                hint.textContent = 'üí° Select a transaction first to see a hint!';
                hint.classList.add('show');
            }
        }

        function resetGame() {
            if (confirm('Are you sure you want to reset the game? You will lose all progress.')) {
                gameState = {
                    cash: 10000, ar: 500, inventory: 2000,
                    equipmentGross: 15000, accumulatedDepreciation: 0, equipment: 15000,
                    ap: 500, loan: 10000, equity: 16500, retainedEarnings: 0,
                    sales: 0, cogs: 0, rent: 0, utilities: 0, wages: 0, depreciation: 0, interest: 0,
                    beginCash: 10000, beginningAR: 500, beginningInventory: 2000,
                    beginEquipmentGross: 15000, beginAccumulatedDepreciation: 0, beginEquipment: 15000,
                    beginningAP: 500, beginLoan: 10000, beginEquityOwner: 16500, beginRetainedEarnings: 0,
                    cfCustomers: 0, cfSuppliers: 0, cfExpenses: 0,
                    cfInvesting: 0, cfFinancing: 0,
                    score: 0, streak: 0, level: 1,
                    processedTransactions: [],
                    transactionHistory: {}
                };
                updateDerivedValues();
                updateDisplay();
                updateScore();
                document.getElementById('level').textContent = 'Level 1: Beginner';
                renderTransactions();
                document.getElementById('feedback').style.display = 'none';
                document.getElementById('hint').classList.remove('show');
            }
        }

        // Event listeners
        document.getElementById('processBtn').addEventListener('click', processTransaction);
        document.getElementById('hintBtn').addEventListener('click', showHint);
        document.getElementById('resetBtn').addEventListener('click', resetGame);

        // Initialize
        init();
    </script>
</body>
</html>
